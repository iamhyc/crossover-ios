<!doctype html>
<html>
 <head>
  <meta http-equiv=content-type content=text/html;charset=utf-8 />
  <meta name=viewport content=width=device-width, initial-scale=1.0,user-scalable=no>
  <link type=text/css href=css/main.css rel=stylesheet>
  <title>滑动回弹</title>
  <!--[if lt ie 9]>      <![endif]-->
  <noscript></noscript>

<style type="text/css">
  body,html {
  background-color:#333; 
  margin: 0; 
  height: 100%; 
  line-height: 2.0; 
  font-family: 'microsoft yahei'; 
  overflow-y:hidden;
  }
#contain{margin: 0 auto; position:relative; width: 100%; max-width: 480px; _width: 480px; height: 100%; cursor: pointer !important;}
#apparea{position: absolute; width: 100%; height: 100%; overflow: hidden;  background-color: #fff;}  
#topinfo{position: absolute;top: 60px;width: 100%; height:60px; text-align: center; font-size: 18px; }
#bottominfo{position: absolute;bottom: 0;width: 100%;}
#scrollerarea{position: absolute; right: 0; width: 1.5%; height: 100%;visibility: hidden;}
#scroller{position: absolute; top:0; width: 100%;  background-color: #aaa;}
#movearea{position: absolute; top:0px; width: 100%; background-color: #ddd;}
</style>

 </head>
 <body>
  <div id="contain">
   <div id="apparea">
    <div id="topinfo">
     logo or animate
    </div>
    <div id="bottominfo">
     some imformation  2014-4-28
    </div>
    <div id="movearea"></div>
    <div id="scrollerarea">
     <div id="scroller"></div>
    </div>
   </div>
  </div>
  <script type="text/javascript">
    window.onload = function() {
 /*测试数据*/
 var insert = '';
 for (var i = 0; i < 80; i++) {
  insert += '<div style = width:100%; text-align:center;>滑动测试 ' + i + '</div>';
 }
 document.getelementbyid(movearea).innerhtml = insert;
 /*测试数据   */
 var at = new apptouch({
  tcontain : 'apparea', //必选：滑动区域id
  tmove : 'movearea', //必选：移动区域id
  tscroller : 'scroller', //必选：自定义滚动条
  tscrollerarea : 'scrollerarea'//必选：滚动条区域
 }, onmoveend);
 //到顶/底回调
 function onmoveend(m) {
  //console.log(m);
 }
}
/*=====================
 * 名称: apptouch
 * 功能: web app滑动模拟组件
 * 参数: 相关配置
 ======================*/
var apptouch = function(config, callback) {
 this.touchcontain = config.tcontain;
 this.touchmove = config.tmove;
 this.touchscroller = config.tscroller;
 this.touchscrollerarea = config.tscrollerarea;
 this.callbackfn = callback;
 this.move();
}
apptouch.prototype = {
 move : function(e) {
  var monitor = document.getelementbyid(this.touchcontain), //监听容器
  target = document.getelementbyid(this.touchmove), //移动目标
  scroller = document.getelementbyid(this.touchscroller), //自定义滚动条
  scrollerarea = document.getelementbyid(this.touchscrollerarea), //滚动条区域
  sheight = monitor.offsetheight / target.offsetheight * monitor.offsetheight, //自定义滚动条的长度
  st = (target.offsetheight - monitor.offsetheight) / (monitor.offsetheight - sheight), //移动块对应滚轮单位长度
  tslow = 4, //到顶/底减基数
  tmove = 0, //滑块到顶top值
  tmovel = tmove + 140, //到顶允许下拉范围
  bmove = monitor.offsetheight - target.offsetheight, //滑块到底top值
  bmovel = bmove - 140, //到底允许上滑范围
  callbackfn = this.callbackfn, //回调函数
  flg = false, //标记是否滑动
  starty, //标记起始位置
  starttop, //标记滑动起始时的高度值
  move = 0;
  //移动距离
  //鼠标事件注册
  addevent(monitor, 'mousedown', movestart);
  addevent(monitor, 'mousemove', movein);
  addevent(monitor, 'mouseup', moveend);
  addevent(window, 'mousemove', movein);
  addevent(window, 'mouseup', moveend);
  //移动设备触摸事件注册
  addevent(monitor, 'touchstart', movestart);
  addevent(monitor, 'touchmove', movein);
  addevent(monitor, 'touchend', moveend);
  /**
   *外观/门面模式包装
   */
  /*事件监听 */
  function addevent(el, type, fn) {
   if (el.addeventlistener) {
    el.addeventlistener(type, fn, false);
   } else if (el.attachevent) {
    el.attachevent('on' + type, fn);
   } else {
    el['on' + type] = fn;
   }
  }
  //取消浏览器默认行为
  function stop(e) {
   //opera/chrome/ff
   if (e.preventdefault)
    e.preventdefault();
   //ie
   e.returnvalue = false;
  }
  //包装结束
  /**
   *操作函数
   */
  //惯性缓动参数
  var lastmovetime = 0;
  var lastmovestart = 0;
  var stopinertiamove = false;
  /*移动触发*/
  function movestart(e) {
   stop(e);
   flg = true;
   if (e.touches)
    e = e.touches[0];
   starty = e.clienty;
   starttop = target.style.top || 0;
   //惯性缓动
   lastmovestart = starty;
   lastmovetime = new date().gettime();
   stopinertiamove = true;
   scrollerarea.style.visibility = 'visible';
  }
  /*移动过程中*/
  function movein(e) {
   if (flg) {
    stop(e);
    if (e.touches)
     e = e.touches[0];
    move = e.clienty - starty + parseint(starttop);
    if (move > tmove) {
     (move - tmove) / tslow + tmove > tmovel ? move = tmovel : move = (move - tmove) / tslow + tmove
    } else if (move < bmove)
     (move - bmove) / tslow + bmove < bmovel ? move = bmovel : move = (move - bmove) / tslow + bmove;
    target.style.top = move + 'px';
    scroller.style.top = -move / st + 'px';
    //惯性缓动
    var nowtime = new date().gettime();
    stopinertiamove = true;
    if (nowtime - lastmovetime > 300) {
     lastmovetime = nowtime;
     lastmovestart = e.clienty;
    }
   }
  }
  /*移动结束*/
  function moveend(e) {
   stop(e);
   if (e.touches)
    e = e.touches[0];
   //惯性缓动
   var contenttop = target.style.top.replace('px', '');
   var contenty = (parseint(contenttop) + e.clienty - lastmovestart);
   var nowtime = new date().gettime();
   var v = (e.clienty - lastmovestart) / (nowtime - lastmovetime);
   //最后一段时间手指划动速度
   stopinertiamove = false;
   (function(v, starttime, contenty) {
    var dir = v > 0 ? -1 : 1;
    //加速度方向
    var deceleration = dir * 0.005;
    function inertiamove() {
     if (stopinertiamove)
      return;
     var nowtime = new date().gettime();
     var t = nowtime - starttime;
     var nowv = v + t * deceleration;
     var movey = (v + nowv) / 2 * t;
     // 速度方向变化表示速度达到0了
     if (dir * nowv > 0) {
      if (move > tmove) {
       callbackfn('到顶了');
       target.style.top = tmove + 'px';
       scroller.style.top = tmove + 'px';
      } else if (move < bmove) {
       callbackfn('到底了');
       target.style.top = bmove + 'px';
       scroller.style.top = -bmove / st + 'px';
      }
      settimeout(function() {
       if (!stopinertiamove)
        scrollerarea.style.visibility = 'hidden';
      }, 4000);
      return;
     }
     move = contenty + movey;
     if (move > tmove) {
      t /= 20;
      move = (move - tmove) / 10 + tmove;
     } else if (move < bmove) {
      t /= 20;
      move = (move - bmove) / 10 + bmove;
     }
     target.style.top = move + px;
     scroller.style.top = -move / st + 'px';
     settimeout(inertiamove, 10);
    }
    inertiamove();
   })(v, nowtime, contenty);
   move = 0;
   flg = false;
  }
  //操作结束
  /**
   *相关初始化
   */
  //滚动条长度初始化
  scroller.style.height = sheight + 'px';
  //初始化结束
 },
 otherinteract : function() {
  //其他功能扩充
 }
}

  </script>
 </body>
</html>