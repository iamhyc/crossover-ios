<!DOCTYPE html>

<html style="height:100%">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
	<title>Member_add</title>
	<script src="javascripts/jquery-1.11.2.js"></script>
	<link rel='stylesheet' href='stylesheets/bootstrap.css' />
	<script type="text/javascript" src="javascripts/styleFunc.js"></script>
	<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
	<link rel='stylesheet' href='stylesheets/style.css' />
	<script type="text/javascript">
		var apiAddress = "http://120.24.223.82:8080/Crossover/Api/";
  		var imgAddress = "http://120.24.223.82:8080/Crossover/images/";
  		var myObj = JSON.parse(localStorage.current_user);

  		$(document).ready(function(){
  			$("#teamHead").attr("src", imgAddress + "TeamLogo/" +myObj.TeamLogo);
  			$("#upload").click(function(){
  				$("#imgFile").click();
  			})
  			document.getElementById("imgFile").addEventListener( 'change',preview,false );
  		})

  		function preview(){
			//var patn = /\.jpg$|\.jpeg$|\.png$|\.gif$/i;
			var file = this.files[0]; 
			var reader = new FileReader(); 
			reader.readAsDataURL(file);
			/* */ 
			reader.onloadend = function(e) {
				$('#upload').attr('src', this.result);
				//upload process?
				//this.result.slice(this.result.indexOf(',')+1)
				}
		}

		function saveCheck(){
			var name = $("#mem_name").val(),
				site = $("#mem_site").val(),
				height = $("#mem_height").val(),
				weight = $('#mem_weight').val(),
				info = $('#mem_info').val(),
				image = $('#imgFile').val();
			if (!name||!site||!height||!weight||!info)
				alert_flash("请输入队员名称和队员资料");
			else if(!image) {
				alert_flash("请选择一张头像");
			}
			else {
				var photoData = $('#upload').attr('src');
				console.log(photoData);
				var data = JSON.stringify({
						"TeamID":myObj.TeamID,
						"PlayerName":name,
						"Detail":info,
						"tall":parseInt(height),
						"weight":parseInt(weight),
						"position":site,
						"PhotoBase64":photoData.slice(photoData.indexOf(',')+1)
				});
				console.log(data);
				$.ajax({
					type:'post',
					url: apiAddress+"player",
					contentType: 'application/json',
					dataType:'json',
					data:data,
					success: 
						function(result){
							if (result) window.location.href="personal.html";
							else {
									alert_flash("添加失败");
									console.log(result);
								}
						}
				})
			}
		}
	</script>
</head>

<body background="images/bg.jpg" style="height:100%;color:#ffffff">
	<div class="container" style="height:100%">
		<nav class="navbar navbar-fixed-top text-left">
    		<span onclick="history.back()"><img src="images/back.png" width="14%"></span>		
		</nav>
		
		<div class="container-fluid" style="height:20%">
			<div class="spc" style="height:40%"></div>
			<div class="row">
  				<div class="col-xs-offset-4 col-sm-offset-4">
  					&nbsp;&nbsp;&nbsp;&nbsp;
  					<img id="teamHead" src="abc.jpg" class="img-circle" width="40%" height="40%">
  				</div>
  				<br />
			</div>

		</div>
		<div class="container text-left" style="height:45%">
			<h3>添加队员</h3>

  				<div class="row">
  					<input type="text" id="mem_name" class="col-xs-5 net-control input-lg"  placeholder="队员名称" style="margin-left:4%">
  					<div class="col-xs-1">&nbsp;</div>
  					<input type="text" id="mem_site" class="col-xs-5 net-control input-lg mem-info" placeholder="所打位置">
  				</div>
  				<br />
  				<div class="row">
  					<input type="text" id="mem_height" class="col-xs-5 net-control input-lg mem-info" onkeypress="return event.keyCode >= 48 && event.keyCode <= 57"  onafterpaste="this.value=this.value.replace(/\D/g,'')" maxlength="3" placeholder="身高cm" style="margin-left:4%">
  					<div class="col-xs-1">&nbsp;</div>
      				<input type="text" id="mem_weight" class="col-xs-5 net-control input-lg mem-info" onkeypress="return event.keyCode >= 48 && event.keyCode <= 57"  onafterpaste="this.value=this.value.replace(/\D/g,'')" maxlength="3" placeholder="体重kg">
  				</div>
  				<br />
      			<textarea id="mem_info" class="net-control input-lg" rows="3" style="width:100%" placeholder="球员简介"></textarea>
		</div>

		<div class="text-center" style="height:25%">
			<div class="container">
  				<input type="file" accept="image/*" class="hidden" name="imgFile" id="imgFile"  />
  				<img src="images/plus.jpg" id="upload" class="img-circle" width="120px" height="120px">
  			</div>
  			<br />
			<div class="inline-btn" style="display:inline-block;width:35%;">
				<button class="btn btn-lg btn-block" onclick="saveCheck()">保存</button>
			</div>	
		</div>
</body>
</html>