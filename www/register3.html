<!DOCTYPE html>

<html style="height:100%">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
	<title>Register2</title>
	<script src="javascripts/jquery-1.11.2.js"></script>
	<script type="text/javascript" src="javascripts/styleFunc.js"></script>
	<script type="text/javascript" src="javascripts/jquery.base64.js"></script>
	<script type="text/javascript" src="javascripts/DES.js"></script>
	<link rel='stylesheet' href='stylesheets/bootstrap.css' />
	<link rel='stylesheet' href='stylesheets/style.css' />
	<script type="text/javascript">
		localStorage.lastView = "register3.html"
		var apiAddress = "http://120.24.223.82:8080/Crossover/Api/";

		function pwdCheck () {
			var t1 = $('#pwd1'), tr1 = $('#pwdr1'),
				t2 = $('#pwd2'), tr2 = $('#pwdr2');
			if (t1.val()==""||t2.val()==""){
				alert_flash("密码不能为空");
			}
			else if (t1.val()!=tr1.val()) {
				alert_flash("管理员密码不符");
				t1.val("");	tr1.val("");
				}
			else if (t2.val()!=tr2.val()){
				alert_flash("队员密码不符");
				t2.val("");	tr2.val("");
				}
			else if (t1.val()==t2.val()) alert_flash("管理员密码和队员密码不能相同")
			else {
				// body...
				var Adpwd = $.base64.btoa(des("isalways", t1.val(), 1, 0, "", 1));
				var pwd = $.base64.btoa(des("isalways", t2.val(), 1, 0, "", 1));
				json = JSON.stringify({
					'Phone':localStorage.reg_phone,
					'AdminPwd':Adpwd,
					'CommonPwd':pwd,
					'TeamName':localStorage.reg_teamName,
					'City':localStorage.reg_cityName,
					'PhotoBase64':localStorage.reg_PhotoBase64
				});
				//console.log(json);
					$.ajax({
						type:'post',
						url: apiAddress+'user/register',
						contentType: 'application/json',
						dataType:'json',
						data:json,
						success:function(data){
							console.log(data);
							if (data.success){
								alert_flash("成功！");
								window.location.href = "index.html"
							}
							else if (data.success == false){
								if (data.reason == "TeamNameExist"){
									alert_flash("队名已存在");
									window.location.href = "register2.html"
								}
								if (data.reason == "PhoneExist"){
									alert_flash("手机已注册");
									window.location.href = "register.html"
								}
							}
							
						}
					})
			}
		}
	</script>
</head>

<body background="images/bg.jpg" style="height:100%">
	<nav class="navbar navbar-fixed-top text-left">
    		<span onclick="location.href='index.html'"><img src="images/back.png" width="14%"></span>		
	</nav>

		<div class="spc" style="height:20%"></div>
		<div class="container content text-left" style="height:80%;color:#ffffff" >
			<div class="form-group input-group-lg" style="width:80%">
        		<input type="password" class="form-control" autofocus id="pwd1" placeholder="管理密码">
      		</div>

      		<div class="form-group input-group-lg" style="width:80%">
        		<input type="password" class="form-control" id="pwdr1" placeholder="确认管理密码">
      		</div>

      		<div class="form-group input-group-lg" style="width:80%">
        		<input type="password" class="form-control" id="pwd2" placeholder="队员密码">
      		</div>

      		<div class="form-group input-group-lg" style="width:80%">
        		<input type="password" class="form-control" id="pwdr2" placeholder="确认队员密码">
      		</div>

			<div class="col-xs-offset-1" >
				<button class="btn btn-lg btn-block" style="width:60%" onclick="pwdCheck()">注册</button>
			</div>
		</div>

</body>
</html>