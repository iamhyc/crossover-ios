<!DOCTYPE html>

<html style="height:100%">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
	<title>Detail_page</title>
	<script src="javascripts/jquery-1.11.2.js"></script>
  <script type="text/javascript" src="javascripts/styleFunc.js"></script>
	<link rel='stylesheet' href='stylesheets/bootstrap.css' />
	<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
	<script type="text/javascript">
    localStorage.lastView = "detail_page.html";
    var apiAddress = "http://120.24.223.82:8080/Crossover/Api/";
    var imgAddress = "http://120.24.223.82:8080/Crossover/images/";
    var myObj = JSON.parse(localStorage.current_user);
    var hisData, hisList, hisPlayer;
    var userShow = JSON.parse(localStorage.userShow);
        userShow = JSON.parse(localStorage['myList'+userShow.pageNow])[userShow.order];
      //UserID: userShow

      $(document).ready(function(){

        $(".score").click(function(){
          if ($('.against').hasClass('hidden')){
            $("#block-bg").css("display", "block");
            $(".against").removeClass('hidden').animate({bottom:"15%"});
          } 
          else {
            $("#block-bg").css("display", "none");
            $(".against").animate({bottom:"-65%"}, function(){$(".against").addClass('hidden')});
          }
      });

      $("#block-bg").click(function(){
          $("#block-bg").css("display", "none");
          $(".against").animate({bottom:"-65%"}, function(){$(".against").addClass('hidden')});
      });

        $.get(apiAddress+'team/teammate/user/'+userShow.UserID+'/team/'+userShow.TeamID, function(data){
          hisData = data;
          hisPlayer = hisData.players;
          hisList = hisData.scoreList;
          //INITIALIZATION ON
          $("#myHead").attr("src", imgAddress + "TeamLogo/" +userShow.TeamLogo);
          $("#myName").text(userShow.TeamName);
          $("#myAddress").text(userShow.City);
          if (userShow.TeamHomePhoto)
              $('#back').attr("src", imgAddress+"TeamHome/"+userShow.TeamHomePhoto).attr("width","100%").attr("height","100%");
          $("#myGrade").text(userShow.lntegral);
          
          //ADD PLAYER
          for (var i = 0; i < hisPlayer.length; i++){
            var img='<div class="col-xs-3" style="padding-top:5%"><img src="'+imgAddress+'Teammate/'+hisPlayer[i].HeadIcon+'" id='+i+' class="img-circle isMem" width="100%" height="100%"></div>';
            $(".portrait").append(img);
          }

          $(".isMem").on('click', function(){
            showMsg(this.id);
          })
          //INITIALIZATION DONE
          generateFinishedList();
        })
      })



  function deal_spc (content) {
    content=content.replace(/\r\n/g,"<BR>")  
    content=content.replace(/\n/g,"<BR>");  
    return content;
  }
  function showMsg(usr){
    //console.log(usr);
    $('#black-bg').css("display", 'block');
      $('#name').text(hisPlayer[usr].PlayerName);
      $('#height').text("身高："+hisPlayer[usr].tall);
      $('#weight').text("体重："+hisPlayer[usr].weight);
      $('#site').text("所打位置："+hisPlayer[usr].position);
      $('#intro').html("简介："+deal_spc(hisPlayer[usr].Detail));
      console.log(hisPlayer[usr].Detail);
      $('#memHead').attr("src", imgAddress+"Teammate/"+hisPlayer[usr].HeadIcon);
    $('.show-block').removeClass("hidden").fadeIn(400);
    //$('body').append(block);
  }

  function deMsg(){
    $('.show-block').fadeOut(400,function(){
      $(this).addClass("hidden");
      $('#black-bg').css('display', 'none');
    });
  }

  function generateFinishedList () {
    $(".fakeBox2 .THead1").attr("src", imgAddress+"TeamLogo/"+userShow.TeamLogo);
    $(".fakeBox2 .TName1 font").text(userShow.TeamName);
    
    for (var i = 0; i < hisList.length; i++){
      $(".fakeBox2 .THead2").attr("src", imgAddress+"TeamLogo/"+hisList[i].TeamLogo);
      $(".fakeBox2 .TName2 font").text(hisList[i].TeamName); 

      var score = hisList[i].Score.split(',');
      //console.log(score);
      if (hisList[i].ActiveID == hisList[i].ActiveTeamID){
        setScore(zeroFill(score[0]), zeroFill(score[1]))
      }
      else {
        setScore(zeroFill(score[1]), zeroFill(score[0]));
      }

      $(".record").append($(".fakeBox2 > .scoreItem").clone());
    }
  }
  function setScore(t1, t2) {
    if (parseInt(t1)>parseInt(t2)){
      $(".fakeBox2 .Team1 .vs").css("background", "#007979");
      $(".fakeBox2 .Team2 .vs").css("background", "#E0E0E0");
    }
    else{
      $(".fakeBox2 .Team1 .vs").css("background", "#E0E0E0");
      $(".fakeBox2 .Team2 .vs").css("background", "#007979");
    }
    $(".fakeBox2 .Team1 .3_t1 p font").text(t1[0]);  
    $(".fakeBox2 .Team1 .2_t1 p font").text(t1[1]);  
    $(".fakeBox2 .Team1 .1_t1 p font").text(t1[2]);
    $(".fakeBox2 .Team2 .3_t2 p font").text(t2[0]);  
    $(".fakeBox2 .Team2 .2_t2 p font").text(t2[1]);  
    $(".fakeBox2 .Team2 .1_t2 p font").text(t2[2]);
  }
  function zeroFill (str) {
    while(str.length < 3){
      str = "0" + str;
    }
    return str;
  }


  function fightVS () {
    if (myObj.TeamID == userShow.TeamID) {
      alert_flash("怎么可以和自己约战呢");return;
    }
    $.get(apiAddress+"arrange/send/"+myObj.TeamID+"/"+userShow.TeamID, function(result){
        if (result.success) alert_flash("约战成功");
        else {
          alert_modal(result.message);
        }
    })
  }


  function turnToPhotos () {
    //console.log(userShow.TeamID);
    localStorage.galleryShow = "0_"+userShow.TeamID;
    window.location.href = 'photos.html';
  }
	</script>
</head>

<body background="images/bg.jpg" style="height:100%">
  <div id="block-bg"></div><div id="black-bg"></div>
  <nav class="navbar navbar-fixed-top" style="margin-bottom:0; padding-top:3%">
        <span onclick="location.href='menu.html'"><img src="images/back.png" width="14%"></span>
  </nav>
	
	<div class="back" style="height:37%;width:100%;text-align:center">
    <img src="" id="back" >
  </div>

	<div class="container-fluid" style="height:10%;background:#ffffff">
		<div class="row">
  			<div class="col-xs-4 col-sm-4 col-md-4">
  				<p id="myAddress" style="text-align:center; color:navy">sz</p>
  			</div>
  			<div class="col-xs-4 col-sm-4 col-md-4" style="margin-top:-45px">
  				<img id="myHead" src="abc.jpg" class="img-circle" width="90%" height="90%" onclick="location.href='detail_seen.html'">
  				<p id="myName" style="text-align:center;color:navy">XXX队</p>
  			</div>
  			<div class="col-xs-4 col-sm-4 col-md-4" style="padding:3px 3% 0 0">
  				<button class="btn btn-lg" style="width:100%;height:40px" onclick="turnToPhotos()">相册</button>
  			</div>
		</div>
		
	</div>
  <div class = "space" style = "height:2px"></div>
	<div class="container-fluid" style="height:40%;background:#ffffff">
		<h4 style="text-align:center;height:5%;color:navy">队员</h4>

		<div class="row portrait" style="height:95%">
		</div>
    
	</div>


<div class="hidden show-block" style="z-index:1092;top:40%;left:3%;width:94%;background:#003D79;border-radius:1em;color:#FFFFFF;position:absolute;">
  <div class="row" style="margin:0 0 0 0" >
    <div class="col-xs-4" style="padding:3% 0%  0% 3%">
      <img id="memHead" src="abc.jpg" class="img-circle" width="70%" height="70%">
    </div>
    <div class="col-xs-8" style="padding-top:4%;height:100%;margin-left:-10%;font-size:1.2em">
      <div id="name" style="height:15%">aaa</div>
      <div id="height"style="height:10%">身高:aaa</div>
      <div id="weight" style="height:10%">体重:aaa</div>
      <div id="site" style="height:10%">所打位置:aaa</div>
      <div id="intro" style="height:10%">简介:aaa </div>
      <div class="spc" style="height:10%;"></div>
      <div style="height:30%;color:#003D79;padding:8% 0 4% 0">
        <button class="btn btn-large" type="button" onclick="deMsg()" style="width:50%;border-radius:0.7em"><font size="3em" color="#003D79">确定</font></button>
      </div>
    </div>
  </div>
</div>

		
	<div class="score row" style="color:#ffffff;width:104%;height:12%">
  		<div class="col-xs-4 col-sm-4 col-md-4 text-right" style="padding:1.5% 0  0 4%">
  			<p id="myGrade" style="font-size:xx-large;">GRADE</p>
  		</div>
  		<div class="col-xs-4 col-sm-4 col-md-4 text-center" style="padding-top:4%;padding-right:0px">
  			<span class="glyphicon glyphicon-star" style="font-size:2em"></span>
  		</div>
  		<div class="col-xs-4 col-sm-4 col-md-4" style="padding:0% 3% 0 0;padding-top:12px">
  			<button class="btn btn-lg btn-block" onclick="fightVS();stopBubble(event)" style = "height:39px;"><p style="margin-top:-3px">约战</p></button>
  		</div>
	</div>




<div class="against hidden" style="height:65%;width:100%;position:absolute;z-index:1091">
  <div class="record " style="background:#FFFFFF;height:100%;width:100%;padding-left:2%;padding-right:2%;padding-top:2%;overflow:scroll">
  <div class="fakeBox2 hidden">
      <!--BEGINNING FOR FINISHED LIST-->
      <div class="scoreItem" height="11em" width="100%" >
          <div style="background:#F6F7F7;height:100%;width:100%;display:inline-flex;">
          <div class="Team1" style="width:46%;height:100%;margin-top:3%;margin-bottom:2%;margin-left:2%">
            <div class="vs" style="background:#007979;height:11em">

              <div style="height:4em;width:100%;display:inline-flex">
                <div style="height:4em;width:35%">
                    <img src="abc.jpg" class="THead1 img-circle" width="75%" height="75%" style="margin-top:13%;margin-left:13%">
                </div>
                <div class="TName1" style="height:100%;width:50%">
                    <p style="margin-top:1.2em"><font size="2.5em" color=" #000093">干</font></p>
                </div>
              </div>

              <!--<div class="space" style="height:0.15em;background:#FFFFFF">&nbsp;</div>-->

              <div class="aga" style="display:inline-flex;height:2.5em">
                <div class="space" style="height:2.5em;width:2.2em;display:inline"></div>
                <div class="3_t1" style="height:5em;width:2.4em;display:inline;background:#FFFFFF;margin-top:1em" >
                    <p style="text-align:center"><font size="8em" color="#000093">0</font></p>
                </div>
                <div class="space" style="height:5em;width:0.2em;display:inline"></div>
                <div class="2_t1" style="height:5em;width:2.4em;display:inline;background:#FFFFFF;margin-top:1em" >
                    <p style="text-align:center"><font size="8em" color="#000093">0</font></p>
                </div>
                <div class="space" style="height:5em;width:0.2em;display:inline"></div>
                <div class="1_t1" style="height:5em;width:2.4em;display:inline;background:#FFFFFF;margin-top:1em" >
                    <p style="text-align:center"><font size="8em" color="#000093">0</font></p>
                </div>
                <div class="devider" style="height:5em;width:3em;display:inline;margin-top:1em" >
                  <p style="text-align:right;margin-top:1em;margin-right:-1.1em"><font size="8em" color="#000093">:</font></p>
                </div>
              </div>
            </div>
          </div>

          <div class="Team2" style="width:50%;height:100%;margin-top:3%;margin-bottom:2%;margin-right:2%">
            <div class="vs" style="background:#E0E0E0;height:11em">

              <div style="height:4em;width:100%;display:inline-flex">
                
                <div class="TName2" style="height:4em;width:70%">
                    <p style="margin-top:1.2em;text-align:right"><font size="2.5em" color=" #000093">干</font></p>
                </div>
                <div style="height:4em;width:35%;">
                    <img src="abc.jpg" class="THead2 img-circle" width="75%" height="75%" style="text-align:right;margin-top:13%;margin-left:13%">
                </div>
              </div>

              <!--<div class="space" style="height:0.15em;background: #FFFFFF">&nbsp;</div>-->
              
              <div class="aga" style="display:inline-flex;height:2.5em">
                <div class="space" style="height:5em;width:3em;display:inline;margin-top: 1em;" >
                    <p style="text-align:left;margin-top:1em;margin-left:-0.5em;"><font size="8em" color="#000093">:</font></p>
                </div>
                <div class="3_t2" style="height:5em;width:2.4em;display:inline;background:#FFFFFF;margin-top: 1em;" >
                    <p style="text-align:center"><font size="8em" color="#000093">0</font></p>
                </div>
                <div class="space" style="height:5em;width:0.2em;display:inline"></div>
                <div class="2_t2" style="height:5em;width:2.4em;display:inline;background:#FFFFFF;margin-top: 1em;" >
                    <p style="text-align:center"><font size="8em" color="#000093">0</font></p>
                </div>
                <div class="space" style="height:5em;width:0.2em;display:inline"></div>
                <div class="1_t2" style="height:5em;width:2.4em;display:inline;background:#FFFFFF;margin-top:1em" >
                    <p style="text-align:center"><font size="8em" color="#000093">0</font></p>
                </div>
              </div>
            </div>
          </div>
          </div>
      </div>
      <!--END FOR FINISHED LIST-->
    </div>
  </div>
</div>

</body>
</html>